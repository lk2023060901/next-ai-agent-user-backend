syntax = "proto3";

package chat;

option go_package = "github.com/liukai/next-ai-agent-user-backend/gateway/internal/pb/chat";

import "common.proto";

// ─── Session ─────────────────────────────────────────────────────────────────

message Session {
  string id = 1;
  string title = 2;
  string workspace_id = 3;
  string status = 4;
  int32 message_count = 5;
  string last_message_at = 6;
  string created_at = 7;
}

message ListSessionsRequest {
  string workspace_id = 1;
  common.UserContext user_context = 2;
}

message ListSessionsResponse {
  repeated Session sessions = 1;
}

message CreateSessionRequest {
  string workspace_id = 1;
  string title = 2;
  common.UserContext user_context = 3;
}

// ─── Message ─────────────────────────────────────────────────────────────────

message ChatMessage {
  string id = 1;
  string session_id = 2;
  string role = 3;
  string content = 4;
  string agent_id = 5;
  string status = 6;
  string created_at = 7;
}

message ListMessagesRequest {
  string session_id = 1;
  common.UserContext user_context = 2;
}

message ListMessagesResponse {
  repeated ChatMessage messages = 1;
}

message SaveUserMessageRequest {
  string session_id = 1;
  string content = 2;
  common.UserContext user_context = 3;
}

// ─── Agent ───────────────────────────────────────────────────────────────────

message AgentItem {
  string id = 1;
  string workspace_id = 2;
  string name = 3;
  string role = 4;
  string color = 5;
  string status = 6;
  string model = 7;
  string description = 8;
  string created_at = 9;
  string updated_at = 10;
}

message ListAgentsRequest {
  string workspace_id = 1;
  common.UserContext user_context = 2;
}

message ListAgentsResponse {
  repeated AgentItem agents = 1;
}

message CreateAgentRequest {
  string workspace_id = 1;
  string name = 2;
  string role = 3;
  string model = 4;
  string color = 5;
  string description = 6;
  string system_prompt = 7;
  common.UserContext user_context = 8;
}

// ─── Service ─────────────────────────────────────────────────────────────────

service ChatService {
  rpc ListSessions(ListSessionsRequest) returns (ListSessionsResponse);
  rpc CreateSession(CreateSessionRequest) returns (Session);
  rpc ListMessages(ListMessagesRequest) returns (ListMessagesResponse);
  rpc SaveUserMessage(SaveUserMessageRequest) returns (ChatMessage);
  rpc ListAgents(ListAgentsRequest) returns (ListAgentsResponse);
  rpc CreateAgent(CreateAgentRequest) returns (AgentItem);
}
